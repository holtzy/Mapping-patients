<!-- This document shows a map of Brisbane with patients geolocalized -->
<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">

<head>
  <title>Brisbane Patient location</title>
  <!-- Load d3.js and the geo projection plugin -->
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
  <!-- Load Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
  <!-- Bootstrap core CSS -->
  <link href="web/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <!-- Custom fonts for this template -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
  <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>
  <!-- Custom styles for this template -->
  <link href="web/style.css" rel="stylesheet">
  <!-- Load data -->
  <script src="data.js"></script>
  <!-- JQUERY -->
  <script src="web/jquery/jquery.min.js"></script>
</head>



<style>
#mapid { height: 600px; }
</style>


<body>

  <header class="masthead" style="padding-top: 150px; padding-bottom: 80px">
    <div class="textlanding">
      <h1>Brisbane patient location</h1>
      <hr class="short_hr">
      <br>
      <br><br>
      <p style="max-width: 700px; margin: auto">This document displays all the patient located in the <u>Brisbane</u> area. In total, 87 patients are geolocated. 23 are female, 76 are male. And anything else we want to say about the <a href="">project</a>.</p>
    </div>
  </header>



  <div class="container">

    <!-- Create an element where the map will take place -->
    <div id="mapid"></div>
    <br>

    <div class="row">
      <div class="col-lg-4">
        <h5>Color shows ..</h5>
        <hr>
        <select id="buttonColor" class="btn btn-xl" style="margin-bottom: 20px; display: inline">
          <option value="o1">Sex</option>
          <option value="o4">Sporadic Familial</option>
        </select>
      </div>
      <div class="col-lg-4">
        <h5>sex</h5>
        <hr>
        <div>
          <input type="checkbox" class="checkbox" value="Male" checked><label>Male</label>
          <input type="checkbox" class="checkbox" value="Female" checked><label>Female</label>
        </div>
      </div>
      <div class="col-lg-4">
        <h5>Sporadic or Familial</h5>
        <hr>
        <div>
          <input type="checkbox" class="checkbox" value="Sporadic" checked><label>Sporadic</label>
          <input type="checkbox" class="checkbox" value="Familial" checked><label>Familial</label>
          <input type="checkbox" class="checkbox" value="unknownSpora" checked><label>Unknown</label>
        </div>
      </div>
    </div>

  </div>

</body>


<footer style="margin-top: 60px">
  <hr class="short_hr">
  <p style="font-size: 13px">A work by the the <a href="https://imb.uq.edu.au">Institute of Molecular Bioscience</a></p>
</footer>




<!-- JAVASCRIPT SECTION = CODE FOR THE MAP -->
<script>

console.log("data:")
console.log(marker)

// Color scale for sex
var colorSex = d3.scaleOrdinal()
  .domain(["Male", "Female"])
  .range(["blue", "red"])

// Color scale for Sporadic / Familial
var colorSporadic = d3.scaleOrdinal()
  .domain(["Sporadic", "Familial", ""])
  .range(["orange", "purple", "grey"])

// mapid is the id of the div where the map will appear
var map = L
  .map('mapid')
  .setView([-27.46, 153], 10);   // center position + zoom

// Add a tile to the map = a background. Comes from OpenStreetmap
L.tileLayer(
    'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>',
    maxZoom: 11,
    }).addTo(map);

// Add a svg layer to the map
L.svg().addTo(map);

// filter data ?
data = marker.filter(function(d){ return d[`Side.of.Onset`] == "LHS" })

// Select the svg area and add circles:
d3.select("#mapid")
  .select("svg")
  .selectAll("myCircles")
  .data(data)
  .enter()
  .append("circle")
    .attr("class", function(d){ return d.Gender + " " + d["Sporadic...Familial"]})
    .attr("cx", function(d){ return map.latLngToLayerPoint([d.lat, d.lon]).x })
    .attr("cy", function(d){ return map.latLngToLayerPoint([d.lat, d.lon]).y })
    .attr("r", 14)
    .style("fill", function(d){ return colorSex(d.Gender)})
    .attr("stroke", function(d){ return colorSex(d.Gender)})
    .attr("stroke-width", 3)
    .attr("fill-opacity", .4)

// Function that update circle position if the map zoom/position changes
function update() {
  d3.selectAll("circle")
    .attr("cx", function(d){ return map.latLngToLayerPoint([d.lat, d.lon]).x })
    .attr("cy", function(d){ return map.latLngToLayerPoint([d.lat, d.lon]).y })
}
// If the user change the map (zoom or drag), I update circle position:
map.on("moveend", update)



// Function that update markers if filter / color buttons are changed
function updateMarkers(){

  // Show all group
  d3.selectAll("circle").transition().duration(1000).style("opacity", 1).attr("r", 14)

  // Hide groups that are unselected
  d3.selectAll(".checkbox").each(function(d){
    cb = d3.select(this);
    grp = cb.property("value")

    // If the box is check, I show the group
    if(cb.property("checked")){
    // Otherwise I hide it
    }else{
      d3.selectAll("."+grp).transition().duration(1000).style("opacity", 0).attr("r", 0)
    }
  })
}
// When a button change, I run the update function
d3.selectAll(".checkbox").on("change",updateMarkers);




// Function that update markers if filter / color buttons are changed
function updateColor(){
  // recover the option that has been chosen
  var selectedOption = d3.select(this).property("value")

  // Option 1: Sex
  if (selectedOption == "o1"){
    d3.selectAll("circle")
      .transition()
      .duration(1000)
      .style("fill", function(d){ return colorSex(d.Gender)})
      .style("stroke", function(d){ return colorSex(d.Gender)})
  }

  // Option 4: sporadic Familial
  if (selectedOption == "o4"){
    d3.selectAll("circle")
      .transition()
      .duration(1000)
      .style("fill", function(d){ return colorSporadic(d["Sporadic...Familial"])})
      .style("stroke", function(d){ return colorSporadic(d["Sporadic...Familial"])})
  }
}
// When a button change, I run the update function
d3.select("#buttonColor").on("change",updateColor);




</script>
